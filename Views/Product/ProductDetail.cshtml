@model ProductDetailViewModel

<link href="~/css/non-admin-style/product-detail-style.css" rel="stylesheet">

<div class="product-detail">
    <div class="product-overview">
        <!-- Hình ảnh sản phẩm -->
        <div class="product-image">
            <img id="product-img" src="@Model.Product.ImagePath" alt="@Model.Product.ProductName" loading="lazy" />
        </div>

        <!-- Thông tin sản phẩm -->
        <div class="product-info">
            <h1 id="product-name">@Model.Product.ProductName</h1>
            <div class="product-id text-mute pb-3">Mã sản phâm: <strong>@Model.Product.ID</strong></div>
            <div>
                <span>Trạng thái:</span>
                @if (Model.Product.IsSold && Model.Product.QuantityInStock > 0)
                {
                    <span id="product-status" class="status-text"><strong>Đang kinh doanh</strong></span>
                    <span class="status-badge in-stock selling">Selling</span>

                    <div class="in-stock-container">
                        <p class="product-price">
                            <span id="product-price">@Model.Product.Price.ToString("C0")</span>
                        </p>

                        <!-- Số lượng -->
                        <div class="quantity-section">
                            <span>Số lượng:</span>
                            <div class="quantity-control">
                                <button class="qty-btn minus">-</button>
                                <span class="quantity" id="quantity-value">1</span>
                                <button class="qty-btn plus">+</button>
                            </div>
                        </div>

                        <!-- Nút thao tác -->
                        <div class="action-buttons">

                            <form asp-action="AddToCart" asp-controller="Product">
                                <input type="hidden" asp-for="@Model.CartItemViewModel.ProductID" value="@Model.Product.ID">
                                <input type="hidden" asp-for="@Model.CartItemViewModel.ProductName"
                                    value="@Model.Product.ProductName">
                                <input type="hidden" asp-for="@Model.CartItemViewModel.ProductPrice"
                                    value="@Model.Product.Price">
                                <input type="hidden" asp-for="@Model.CartItemViewModel.ImagePath"
                                    value="@Model.Product.ImagePath">
                                <input type="hidden" asp-for="@Model.CartItemViewModel.Quantity" class="QuantityInput"
                                    value="1" />

                                <button type="submit" class="add-to-cart-btn"><i class="fas fa-shopping-cart"></i> THÊM VÀO
                                    GIỎ HÀNG</button>
                            </form>

                            <form asp-action="BuyNow" asp-controller="Product">
                                <input type="hidden" asp-for="@Model.CartItemViewModel.ProductID" value="@Model.Product.ID">
                                <input type="hidden" asp-for="@Model.CartItemViewModel.ProductName"
                                    value="@Model.Product.ProductName">
                                <input type="hidden" asp-for="@Model.CartItemViewModel.ProductPrice"
                                    value="@Model.Product.Price">
                                <input type="hidden" asp-for="@Model.CartItemViewModel.ImagePath"
                                    value="@Model.Product.ImagePath">
                                <input type="hidden" asp-for="@Model.CartItemViewModel.Quantity" class="QuantityInput"
                                    value="1" />

                                <button type="submit" class="buy-now-btn"><i class="fas fa-bolt"></i> MUA NGAY</button>

                            </form>
                        </div>

                        <div class="extend-infor">
                            <p><i class="fas fa-check-circle" style="color: var(--color-accent);"></i> Miễn phí vận
                                chuyển</p>
                            <p><i class="fas fa-check-circle" style="color: var(--color-accent);"></i> Đổi trả trong 7
                                ngày</p>
                            <p><i class="fas fa-check-circle" style="color: var(--color-accent);"></i> Hỗ trợ 24/7</p>
                        </div>
                    </div>

                }
                else
                {

                    <span id="product-status" class="status-text"><strong>Ngưng kinh doanh / Hết hàng</strong></span>
                    <span class="status-badge out-of-stock stop-selling">Stop Selling</span>

                    <div class="out-of-stock-container">
                        <div class="out-of-stock-content">
                            <div class="price-placeholder">
                                <span class="original-price">@Model.Product.Price.ToString("C0")</span>
                                <span class="out-of-stock-label">(Tạm ngừng)</span>
                            </div>

                            <div class="out-of-stock-message">
                                <i class="fas fa-exclamation-triangle" style="color: var(--color-dark-coral);"></i>
                                <p class="mb-0">Rất tiếc, sản phẩm này hiện không có sẵn để bán.</p>
                            </div>

                            <div class="contact-suggestion">
                                <p>Bạn có thể:</p>
                                <ul>
                                    <li><i class="fas fa-chevron-right" style="color: var(--color-accent);"></i> Liên hệ
                                        chúng tôi để biết thêm thông tin</li>
                                    <li><i class="fas fa-chevron-right" style="color: var(--color-accent);"></i> Xem các
                                        sản phẩm tương tự</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                }
            </div>

        </div>
    </div>

    <!-- Mô tả sản phẩm -->
    <div class="product-description-section">
        <h2>MÔ TẢ SẢN PHẨM</h2>

        <p id="product-full-description">
            @Html.Raw(Model.Product.Description)
        </p>

    </div>

    <!-- Sản phẩm liên quan -->
    <div class="related-products">
        <h2>SẢN PHẨM LIÊN QUAN</h2>
        <div class="related-list">
            @{
                var random = new Random();
                var shuffledProducts = Model.Products.OrderBy(x => random.Next()).Take(5);
            }

            @foreach (var product in shuffledProducts)
            {
                if (product.ProductType == Model.Product.ProductType)
                {
                    <a class="related-item" href="@Url.Action("ProductDetail", "Product", new { id = product.ID })">
                        <img src="@product.ImagePath" alt="@product.ProductName" />
                        <p class="product-name">@product.ProductName</p>
                        <span class="current-price">@product.Price.ToString("C0")</span>
                        <button class="view-detail">Xem chi tiết</button>
                    </a>
                }
            }
        </div>
    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const minusBtn = document.querySelector(".qty-btn.minus");
        const plusBtn = document.querySelector(".qty-btn.plus");
        const quantitySpan = document.getElementById("quantity-value");
        const quantityInputs = document.querySelectorAll(".QuantityInput");

        minusBtn.addEventListener("click", function () {
            let quantity = parseInt(quantitySpan.textContent);

            if (quantity > 1) {
                quantity--;
                quantitySpan.textContent = quantity;

                quantityInputs.forEach(input => input.value = quantity);
            }
        });

        plusBtn.addEventListener("click", function () {
            let quantity = parseInt(quantitySpan.textContent);

            if (quantity >= @Model.Product.QuantityInStock) {
                return;
            }

            quantity++;
            quantitySpan.textContent = quantity;

            // Cập nhật giá trị cho tất cả các input số lượng
            quantityInputs.forEach(input => input.value = quantity);
        });
    });

</script>
