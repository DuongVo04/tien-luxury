@model MessageListViewModel

<link href="~/css/admin-style/messages-management.css" rel="stylesheet">

<nav class="navbar navbar-light">
    <div class="container-fluid">
        <span class="navbar-brand">Messages Management</span>
    </div>
</nav>


<div class="message-container">
    <!-- Message List -->
    <div class="message-list">

        <h3>Danh sách tin nhắn</h3>

        @{
            foreach (var m in Model.Messages)
            {
                <div class="message-item" data-id="@m.Id" data-name="@m.CustomerName" data-email="@m.Email"
                    data-phone="@m.PhoneNumber" data-content="@m.Content.Replace("\"", "&quot;")">

                    <div class="message-name">@m.CustomerName</div>
                    <div class="message-email">@m.Email</div>
                    <div class="message-phone">@m.PhoneNumber</div>
                </div>
            }
        }
    </div>

    <!-- Message Detail -->
    <div class="message-detail hidden" id="message-detail">
        <div class="detail-header d-flex justify-content-between align-items-center">
            <div class="customer-infor">
                <div class="detail-name" id="detail-name"></div>
                <div class="detail-phone" id="detail-phone"></div>
                <div class="detail-email" id="detail-email"></div>
            </div>
            <div class="action-bnutton">
                <button class="delete-btn"><i class="fas fa-trash"></i> Xóa tin nhắn</button>
            </div>
        </div>
        <div class="message-content" id="detail-content">
            <h4>Nội dung tin nhắn:</h4>
            <p id="content-paragraph"></p>
        </div>
    </div>

</div>

<script>
    // Select message item
    const messageItems = document.querySelectorAll('.message-item');

    messageItems.forEach(item => {
        item.addEventListener('click', function () {
            // Remove active class
            messageItems.forEach(i => i.classList.remove('active'));
            this.classList.add('active');

            // Hiện phần detail nếu đang bị ẩn
            const detailBox = document.getElementById('message-detail');
            detailBox.classList.remove('hidden');

            // Lấy dữ liệu từ data attributes
            const name = this.dataset.name;
            const email = this.dataset.email;
            const phone = this.dataset.phone;
            const content = this.dataset.content;

            document.getElementById('detail-name').textContent = name;
            document.getElementById('detail-email').textContent = email;
            document.getElementById('detail-phone').textContent = phone;
            document.getElementById('content-paragraph').textContent = content;
        });
    });


    document.querySelector('.delete-btn').addEventListener('click', function () {
        if (confirm('Bạn có chắc chắn muốn xóa tin nhắn này?')) {
            $.ajax({
            url: "/Admin/MessagesManagement/DeleteMessage",
            type: "POST",
            data: {
                id: document.querySelector('.message-item.active').dataset.id
            },
            success: function (response) {
                if (response.success) {
                    alert("Xóa tin nhắn thành công!");

                    const activeItem = document.querySelector('.message-item.active');
                    if (activeItem) {
                        activeItem.remove();
                    }

                    document.getElementById('message-detail').classList.add('hidden');
                } else {
                    alert("Xóa tin nhắn thất bại, vui lòng thử lại!");
                }
               
            },
            error: function () {
                alert("Đã xảy ra lỗi, vui lòng thử lại!");
            }
        });
        }
    });
</script>